<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Two types of rate limiting on aggregated content | KrakenD Playground</title><meta name="description" content="Aggregates campaigns and products from the shop using different ratelimits"/><meta name="next-head-count" content="4"/><link rel="preload" href="/demo/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/demo/_next/static/css/eb40571f44784f1d.css" as="style"/><link rel="stylesheet" href="/demo/_next/static/css/eb40571f44784f1d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/demo/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/demo/_next/static/chunks/main-6c73a3527fb4e54c.js" defer=""></script><script src="/demo/_next/static/chunks/pages/_app-67f7404471ff431e.js" defer=""></script><script src="/demo/_next/static/chunks/pages/use-cases/shop-a103ab5a71bb4d99.js" defer=""></script><script src="/demo/_next/static/trIni8UhlOIy_9CX6j_ru/_buildManifest.js" defer=""></script><script src="/demo/_next/static/trIni8UhlOIy_9CX6j_ru/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="__className_5e8dbd"><header><div class="container--boxed"><div class="relative py-4 lg:py-6"><div class="text-white flex items-center justify-between h-full"><div class="relative z-10"><a href="/demo/"><svg xmlns="http://www.w3.org/2000/svg" width="157" height="31" fill="none" aria-label="KrakenD"><g fill="#fff" clip-path="url(#logo-krakend-bw_svg__a)"><path d="M15.024.928c4.024 0 7.796 1.531 10.619 4.31 2.84 2.797 4.405 6.555 4.405 10.58 0 8.332-6.74 15.11-15.024 15.11-6.178 0-11.497-3.77-13.803-9.143l-.059-.13A15.2 15.2 0 0 1 0 15.818c0-4.025 1.565-7.783 4.405-10.58C7.23 2.46 11 .929 15.024.929zm1.051 4.44-.201.029-.017.002.01-.001.007-.001.203-.023-.21.024-.014.002-.02.003.244-.029c-4.6.48-6.644 3.863-6.628 7.002q.004.536.088 1.05a7.77 7.77 0 0 1 4.854-1.682c4.308 0 7.77 3.474 7.88 7.91.053 2.12-.676 4.023-2.108 5.5-1.628 1.68-3.992 2.644-6.694 2.743-.262.018-.52.023-.772.023-2.542 0-4.568-.502-6.168-1.221a13.64 13.64 0 0 0 8.495 2.96c7.588 0 13.762-6.21 13.762-13.841.001-1.26-.17-2.516-.51-3.73l-.132-.441-.161-.28c-3.09-5.176-8.104-6.501-11.908-5.999m-1.051-3.17c-3.692 0-7.15 1.402-9.736 3.948-2.596 2.556-4.025 5.991-4.025 9.672 0 1.941.4 3.79 1.12 5.469.42.855 3.04 5.482 10.624 5.36v-.012c2.551 0 4.772-.84 6.252-2.368 1.19-1.226 1.795-2.81 1.75-4.582a7 7 0 0 0-.102-1.05 7.77 7.77 0 0 1-4.84 1.67c-4.323 0-7.858-3.554-7.88-7.923-.022-4.318 3.063-7.678 7.531-8.245l-.076.011c2.636-.408 5.84-.023 8.722 1.727l.329.207-.204-.195c-2.554-2.382-5.9-3.689-9.465-3.689m-4.598 17.829a2.6 2.6 0 0 1 2.59 2.604 2.6 2.6 0 0 1-2.59 2.604 2.6 2.6 0 0 1-2.59-2.604 2.6 2.6 0 0 1 2.59-2.604m0 1.27c-.732 0-1.327.598-1.327 1.334 0 .735.596 1.334 1.327 1.334.732 0 1.327-.599 1.327-1.334s-.595-1.335-1.327-1.335zm-4.945-6.668a3.01 3.01 0 0 1 2.997 3.014 3.01 3.01 0 0 1-2.997 3.014 3.01 3.01 0 0 1-2.996-3.014 3.01 3.01 0 0 1 2.996-3.014m20.023.057a2.6 2.6 0 0 1 2.589 2.605 2.6 2.6 0 0 1-2.59 2.604 2.6 2.6 0 0 1-2.589-2.604 2.6 2.6 0 0 1 2.59-2.605M5.48 15.9a1.74 1.74 0 0 0-1.734 1.744c0 .961.778 1.744 1.734 1.744.957 0 1.735-.783 1.735-1.744 0-.962-.778-1.744-1.735-1.744m8.91-2.886a6.54 6.54 0 0 0-4.487 1.764c.968 2.49 3.37 4.258 6.163 4.258a6.53 6.53 0 0 0 4.469-1.746c-.977-2.525-3.349-4.276-6.145-4.276m11.113 2.943c-.732 0-1.327.598-1.327 1.334s.595 1.335 1.327 1.335c.731 0 1.327-.599 1.327-1.335s-.596-1.334-1.327-1.334m-3.276-8.049a3.01 3.01 0 0 1 2.997 3.014 3.01 3.01 0 0 1-2.997 3.014 3.01 3.01 0 0 1-2.997-3.014 3.01 3.01 0 0 1 2.997-3.014M5.445 8.67a2.285 2.285 0 0 1 2.276 2.29 2.285 2.285 0 0 1-2.276 2.287 2.285 2.285 0 0 1-2.276-2.288A2.285 2.285 0 0 1 5.445 8.67m16.783.508c-.956 0-1.734.783-1.734 1.744 0 .962.778 1.745 1.734 1.745s1.734-.783 1.734-1.745a1.74 1.74 0 0 0-1.734-1.744M5.445 9.94c-.559 0-1.013.457-1.013 1.02 0 .561.454 1.018 1.013 1.018s1.013-.457 1.013-1.019S6.004 9.94 5.445 9.94m10.293-3.424a2.285 2.285 0 0 1 2.275 2.289 2.285 2.285 0 0 1-2.275 2.288 2.285 2.285 0 0 1-2.276-2.288 2.285 2.285 0 0 1 2.276-2.289m0 1.27c-.56 0-1.014.456-1.014 1.018s.455 1.019 1.014 1.019 1.013-.457 1.013-1.019-.455-1.018-1.013-1.018m24.326.877 4.742-2.735v9.76l5.554-6.21h5.68l-6.366 6.719 6.583 10.35h-5.429l-4.368-6.975-1.654 1.784v5.19h-4.742zm17.221.814h4.743v3.44c.967-2.357 2.527-3.885 5.335-3.758v5.063h-.25c-3.15 0-5.085 1.943-5.085 6.019v6.305h-4.743zM67.3 21.642v-.064c0-3.726 2.777-5.445 6.74-5.445 1.685 0 2.901.286 4.087.7v-.286c0-2.006-1.217-3.12-3.588-3.12-1.81 0-3.09.35-4.618.923l-1.185-3.694c1.84-.828 3.65-1.37 6.49-1.37 2.589 0 4.461.701 5.647 1.911 1.248 1.274 1.81 3.153 1.81 5.445v9.904h-4.587V24.7c-1.155 1.306-2.746 2.166-5.055 2.166-3.15 0-5.74-1.848-5.74-5.223zm10.89-1.115v-.86c-.811-.382-1.873-.636-3.027-.636-2.028 0-3.276.828-3.276 2.356v.064c0 1.306 1.06 2.07 2.59 2.07 2.215 0 3.713-1.242 3.713-2.994m6.858-11.864 4.743-2.735v9.76l5.554-6.21h5.678l-6.365 6.719 6.584 10.35h-5.43l-4.368-6.975-1.653 1.784v5.19h-4.743z"></path><path d="M100.68 18.107v-.064c0-4.872 3.4-8.884 8.267-8.884 5.585 0 8.144 4.426 8.144 9.267 0 .382-.031.828-.063 1.273H105.39c.468 2.198 1.966 3.344 4.088 3.344 1.59 0 2.746-.51 4.056-1.75l2.714 2.45c-1.56 1.975-3.806 3.185-6.832 3.185-5.024 0-8.737-3.598-8.737-8.82zm11.793-1.432c-.28-2.166-1.529-3.63-3.526-3.63-1.966 0-3.244 1.432-3.619 3.63zm6.422-7.198h4.742v2.421c1.092-1.433 2.496-2.739 4.899-2.739 3.588 0 5.679 2.42 5.679 6.337v11.05h-4.743v-9.521c0-2.293-1.06-3.471-2.87-3.471s-2.965 1.178-2.965 3.47v9.522h-4.742zm22.868-3.549h3.511c6.491 0 10.976 4.315 10.976 9.943v.057c0 5.629-4.485 10-10.976 10h-8.054V9.899zm3.511 16.029c3.718 0 6.226-2.429 6.226-5.972v-.057c0-3.543-2.508-6.029-6.226-6.029h-3.51v12.058z"></path></g><defs><clipPath id="logo-krakend-bw_svg__a"><path fill="#fff" d="M0 0h157v31H0z"></path></clipPath></defs></svg></a></div><nav class="flex items-center justify-end"><ul class="flex gap-3 md:gap-6 items-center justify-between"><li><a class="font-medium text-base hover:underline flex items-end gap-2.5" target="_blank" rel="noopener" href="https://www.krakend.io/docs/"><span class="leading-none">Docs</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 26" width="24" height="24"><g fill="none" fill-rule="evenodd"><path d="M0 2h24v24H0z"></path><g stroke="#FFF" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m18.75 4.38-6.719 9.596m.995-8.496 5.724-1.1.924 5.754M17.622 15.301v7.417c0 1.26-.999 2.282-2.231 2.282H4.23C3 25 2 23.978 2 22.718v-11.41c0-1.26 1-2.282 2.232-2.282h6.137"></path></g></g></svg></a></li><li><a class="font-medium text-base hover:underline flex items-end gap-2.5" href="https://www.krakend.io"><span class="leading-none">Website</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 26" width="24" height="24"><g fill="none" fill-rule="evenodd"><path d="M0 2h24v24H0z"></path><g stroke="#FFF" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m18.75 4.38-6.719 9.596m.995-8.496 5.724-1.1.924 5.754M17.622 15.301v7.417c0 1.26-.999 2.282-2.231 2.282H4.23C3 25 2 23.978 2 22.718v-11.41c0-1.26 1-2.282 2.232-2.282h6.137"></path></g></g></svg></a></li></ul></nav></div></div></div></header><section class="section--sm"><div class="container--boxed"><div class="flex mb-7"><button class="button--primary flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="size-6"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m14.998 17.998-5.8-5.528a.667.667 0 0 1 0-.944l5.8-5.528"></path></svg><span class="text-base">Go back</span></button></div><div><p class="text--lg text-brand-neutral-300 mb-2">Feature</p><h1 class="heading--h3 mb-5 text-white">Two types of rate limiting on aggregated content</h1><div class="flex flex-col lg:flex-row gap-12"><div class="lg:w-1/2 overflow-auto"><p class="text--lg text-white font-semibold mb-5">Endpoint Configuration</p><pre class="text-sm relative"><button class="absolute right-2 top-3 sm:right-6 sm:top-4 icon text-brand-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" class="copy_svg__h-6 copy_svg__w-6 copy_svg__inline" viewBox="0 0 24 24" width="20" height="20"><g fill="none" fill-rule="evenodd"><path d="M0 .13h24v24H0z"></path><g stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16.2 7.538v-.91a1.2 1.2 0 0 0-.351-.849L13.55 3.482a1.2 1.2 0 0 0-.848-.352H6.2A1.2 1.2 0 0 0 5 4.33v11.2a1.2 1.2 0 0 0 1.2 1.2h2.397" opacity="0.7"></path><path d="M19.8 19.93a1.2 1.2 0 0 1-1.2 1.2H9.8a1.2 1.2 0 0 1-1.2-1.2V8.73a1.2 1.2 0 0 1 1.2-1.2h6.504a1.2 1.2 0 0 1 .848.352l2.297 2.297a1.2 1.2 0 0 1 .351.848z"></path></g></g></svg></button><code class="language-json">{
  &quot;@comment&quot;: &quot;Feature: Two types of rate limiting on aggregated content&quot;,
  &quot;endpoint&quot;: &quot;/shop&quot;,
  &quot;backend&quot;: [
    {
      &quot;host&quot;: [
        &quot;http://fake_api&quot;
      ],
      &quot;url_pattern&quot;: &quot;/shop/campaigns.json&quot;,
      &quot;allow&quot;: [
        &quot;campaigns&quot;
      ]
    },
    {
      &quot;host&quot;: [
        &quot;http://fake_api&quot;
      ],
      &quot;url_pattern&quot;: &quot;/shop/products.json&quot;,
      &quot;allow&quot;: [
        &quot;products&quot;
      ],
      &quot;extra_config&quot;: {
        &quot;qos/ratelimit/proxy&quot;: {
          &quot;max_rate&quot;: 1,
          &quot;capacity&quot;: 1
        }
      }
    }
  ],
  &quot;extra_config&quot;: {
    &quot;qos/ratelimit/router&quot;: {
      &quot;max_rate&quot;: 2
    },
    &quot;documentation/openapi&quot;: {
      &quot;summary&quot;: &quot;Aggregates campaigns and products from the shop using different ratelimits&quot;,
      &quot;description&quot;: &quot;This endpoint fetches the campaigns and products from the shop. The campaigns are fetched without ratelimit, but the products are fetched with a rate limit of 1 request per second. The endpoint itself has a rate limit of 2 requests per second.&quot;,
      &quot;tags&quot;: [
        &quot;Throttling and Acceleration&quot;
      ]
    }
  }
}</code></pre></div><div class="lg:w-1/2"><div class="prose--mdx"><h2>Endpoint</h2>
<div class="relative"><pre><code class="language-http">/shop
</code></pre><button class="absolute right-2 top-2 text-brand-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" class="copy_svg__h-6 copy_svg__w-6 copy_svg__inline" viewBox="0 0 24 24" width="20" height="20"><g fill="none" fill-rule="evenodd"><path d="M0 .13h24v24H0z"></path><g stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16.2 7.538v-.91a1.2 1.2 0 0 0-.351-.849L13.55 3.482a1.2 1.2 0 0 0-.848-.352H6.2A1.2 1.2 0 0 0 5 4.33v11.2a1.2 1.2 0 0 0 1.2 1.2h2.397" opacity="0.7"></path><path d="M19.8 19.93a1.2 1.2 0 0 1-1.2 1.2H9.8a1.2 1.2 0 0 1-1.2-1.2V8.73a1.2 1.2 0 0 1 1.2-1.2h6.504a1.2 1.2 0 0 1 .848.352l2.297 2.297a1.2 1.2 0 0 1 .351.848z"></path></g></g></svg></button></div>
<h2>Stateless rate limiting</h2>
<p>This use case demonstrates two different types of stateless rate limiting while doing API composition:</p>
<ul>
<li>The <code>qos/ratelimit/proxy</code> limits the interaction between the gateway and the backend at 1 request per second</li>
<li>The  <code>qos/ratelimit/router</code> limits the interaction between the user and the gateway at 2 requests per second</li>
</ul>
<p>As you can see, the configuration has two backends, and one has no limitation <code>qos/ratelimit/proxy</code>.</p>
<p>Now, if you call this endpoint more than 1-2 times per second, you will start to see the limitations.</p>
<h3>Rate limit exceeded</h3>
<p>If you call the <code>/shop</code> endpoint more than 2 times within one second you will get an error status code and no response:</p>
<div class="relative"><pre><code>curl -i http://localhost:8080/shop
</code></pre><button class="absolute right-2 top-2 text-brand-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" class="copy_svg__h-6 copy_svg__w-6 copy_svg__inline" viewBox="0 0 24 24" width="20" height="20"><g fill="none" fill-rule="evenodd"><path d="M0 .13h24v24H0z"></path><g stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M16.2 7.538v-.91a1.2 1.2 0 0 0-.351-.849L13.55 3.482a1.2 1.2 0 0 0-.848-.352H6.2A1.2 1.2 0 0 0 5 4.33v11.2a1.2 1.2 0 0 0 1.2 1.2h2.397" opacity="0.7"></path><path d="M19.8 19.93a1.2 1.2 0 0 1-1.2 1.2H9.8a1.2 1.2 0 0 1-1.2-1.2V8.73a1.2 1.2 0 0 1 1.2-1.2h6.504a1.2 1.2 0 0 1 .848.352l2.297 2.297a1.2 1.2 0 0 1 .351.848z"></path></g></g></svg></button></div>
<h3>Partially rate-limited</h3>
<p>If you call the endpoint quickly enough not to pass the 2 requests per second but surpass 1 request per second, then you will have a partial response containing the backend that is not a rate limit at the proxy level. So the response contains <code>campaigns</code> but it does not have <code>products</code>.</p>
<p>To see all types of rate limiting, see the <a href="https://www.krakend.io/docs/enterprise/throttling/">Throttling documentation</a></p></div></div></div></div></div></section><section class="section--xl"><div class="container--boxed"><div class="relative px-5 md:px-10 py-16 overflow-hidden bg-gradient--lavender text-center rounded-xl"><div class="absolute hidden md:block left-0 top-0 pointer-events-none"><img alt="" loading="lazy" width="459" height="331" decoding="async" data-nimg="1" style="color:transparent" src="/demo/_next/static/media/illustration-top.b94e0ea1.png"/></div><h2 class="text-center heading--h2 text-white">Questions?</h2><p class="text-white/65 heading--h3 mt-3 mb-8">If you have any questions, contact us</p><a class="button--primary" href="https://www.krakend.io/support/">Ask Support</a></div></div></section><footer><div class="container--boxed"><div class="border-t border-solid border-brand-neutral-500 border-opacity-40 py-10 md:py-4 flex items-center justify-between flex-col md:flex-row gap-6 md:gap-4"><p class="text-brand-neutral-300 text-sm">Copyright Â© 2017 - <!-- -->2025<!-- --> KRAKEND S.L.</p><div class="flex flex-row items-center gap-5"><a href="https://twitter.com/krakend_io" class="text-brand-neutral-300 hover:text-white transition-colors" target="_blank" rel="noopener noreferrer"><svg viewBox="0 0 17 16" class="size-4"><path fill="currentcolor" d="m.121 0 6.266 8.727L0 16h2.414l5.053-5.77L11.609 16H17l-6.565-9.158L16.428 0h-2.377l-4.69 5.342L5.53 0z"></path></svg></a><a href="https://www.linkedin.com/company/krakend/" class="text-brand-neutral-300 hover:text-white transition-colors" target="_blank" rel="noopener noreferrer"><svg viewBox="0 0 16 16" class="size-4"><path fill="currentcolor" d="M14.222 0H1.778C.796 0 0 .796 0 1.778v12.444C0 15.204.796 16 1.778 16h12.444c.982 0 1.778-.796 1.778-1.778V1.778C16 .796 15.204 0 14.222 0M5.333 12.444H3.091V6.222h2.242zm-1.16-7.362c-.686 0-1.144-.457-1.144-1.067s.457-1.067 1.219-1.067c.685 0 1.143.457 1.143 1.067s-.457 1.067-1.219 1.067zm9.16 7.362h-2.17v-3.4c0-.94-.579-1.158-.796-1.158s-.94.145-.94 1.158v3.4H7.184V6.222h2.243v.869c.289-.507.867-.869 1.953-.869 1.085 0 1.953.869 1.953 2.822z"></path></svg></a><a href="https://github.com/krakend/" class="text-brand-neutral-300 hover:text-white transition-colors" target="_blank" rel="noopener noreferrer"><svg viewBox="0 0 24 24" class="size-4"><path fill="currentcolor" d="M12 0c6.628 0 12 5.508 12 12.304 0 5.434-3.434 10.045-8.2 11.673-.608.121-.824-.263-.824-.59 0-.406.014-1.73.014-3.377 0-1.147-.384-1.896-.814-2.278 2.672-.304 5.48-1.345 5.48-6.07 0-1.344-.466-2.441-1.236-3.303.125-.31.536-1.562-.118-3.257 0 0-1.005-.33-3.296 1.262A11.3 11.3 0 0 0 12 5.95a11.3 11.3 0 0 0-3.004.414c-2.293-1.592-3.3-1.262-3.3-1.262-.652 1.695-.24 2.946-.117 3.257-.767.862-1.236 1.959-1.236 3.303 0 4.713 2.802 5.77 5.467 6.08-.343.307-.654.85-.762 1.645-.684.315-2.422.858-3.492-1.022 0 0-.635-1.182-1.84-1.269 0 0-1.17-.015-.081.748 0 0 .786.378 1.332 1.8 0 0 .704 2.196 4.043 1.452.006 1.028.016 1.998.016 2.29 0 .326-.22.706-.82.592C3.439 22.352 0 17.74 0 12.304 0 5.508 5.374 0 12 0"></path></svg></a><a href="https://medium.com/krakend" class="text-brand-neutral-300 hover:text-white transition-colors" target="_blank" rel="noopener noreferrer"><svg viewBox="0 0 22 13" class="size-4"><path fill="currentcolor" d="M6.417 0A6.4 6.4 0 0 0 .86 3.25a6.57 6.57 0 0 0 0 6.5A6.4 6.4 0 0 0 6.417 13a6.4 6.4 0 0 0 5.557-3.25 6.57 6.57 0 0 0 0-6.5A6.4 6.4 0 0 0 6.417 0M16.5.464c-1.519 0-2.75 2.703-2.75 6.036s1.231 6.036 2.75 6.036 2.75-2.703 2.75-6.036S18.019.464 16.5.464m4.583 1.393c-.506 0-.916 2.079-.916 4.643s.41 4.643.916 4.643c.507 0 .917-2.079.917-4.643s-.41-4.643-.917-4.643"></path></svg></a></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/use-cases/shop","query":{},"buildId":"trIni8UhlOIy_9CX6j_ru","assetPrefix":"/demo","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>