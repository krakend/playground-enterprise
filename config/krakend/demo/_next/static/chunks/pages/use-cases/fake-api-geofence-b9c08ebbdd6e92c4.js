(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4325],{1192:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/use-cases/fake-api-geofence",function(){return t(4182)}])},4182:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return a}});var o=t(5893),i=t(1644),r=t(8563);let s=function(e){let{children:n}=e;return(0,o.jsx)(r.Z,{children:n})};function c(e){let n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{children:"Endpoint"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"/fake-api-geofence/*\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"IMPORTANT NOTE"}),": to use geofencing, you should download a ",(0,o.jsx)(n.a,{href:"https://dev.maxmind.com/geoip/geolite2-free-geolocation-data?lang=en",children:"Maxmind GeoIP City database"})," (commercial or free) and store it on ",(0,o.jsx)(n.code,{children:"config/krakend/geoip/"})," before starting KrakenD."]}),"\n",(0,o.jsx)(n.h2,{children:"Wildcard routes with Geofencing"}),"\n",(0,o.jsxs)(n.p,{children:["This is the same ",(0,o.jsxs)(n.a,{href:"/demo/use-cases/fake-api",children:[(0,o.jsx)(n.code,{children:"fake-api"})," wildcard functionality"]})," that calls our open fake backend, but before trying to retrieve its contents, it will check the user's country first."]}),"\n",(0,o.jsx)(n.p,{children:"The Geofencing functionality is enabled at the service level and does not require a specific endpoint configuration. It enriches the request with Geodata to be used in the endpoint or passed to the backend. In the endpoint, we have only forwarded one header:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:' "input_headers": [\n    "X-Geoip"\n  ]\n'})}),"\n",(0,o.jsxs)(n.p,{children:["This allows the ",(0,o.jsx)(n.code,{children:"X-Geoip"})," header to pass, and then we have an expression that checks that the IP matches Spain's ",(0,o.jsx)(n.code,{children:"IsoCode"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"For the test, you must call the API from an IP that resolves to a Spanish IP, or you can change the IsoCode to your country and call it from the Internet (local IPs do not resolve to any country)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"curl -iG 'http://localhost:8080/fake-api-geofence/articles.json'\n"})})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.jsx)(s,{...e,children:(0,o.jsx)(c,{...e})})}}},function(e){e.O(0,[9814,4729,6103,2888,9774,179],function(){return e(e.s=1192)}),_N_E=e.O()}]);